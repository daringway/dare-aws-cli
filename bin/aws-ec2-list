#!/usr/bin/env python

import boto3
import sys

find = None
if len(sys.argv) > 1:
    find = sys.argv[1]

client = boto3.client('ec2')

RunFilter = [ { 'Name': 'instance-state-name', 'Values': ['running']}]

response = client.describe_instances(Filters = RunFilter)

def getTag(key, tags):
    for i in tags:
        if i['Key'] == key:
            return i['Value'].replace(' ', '-')


for r in response['Reservations']:
    for i in r['Instances']:
        if (find == None) or (find.lower() in str(i).lower()):
            try:
                print i['InstanceId'], getTag('Name', i['Tags']), i['PrivateIpAddress'], i['KeyName']
            except KeyError:
                print i['InstanceId'], getTag('Name', i['Tags']), i['PrivateIpAddress'], 'NONE'
            # print(i);
